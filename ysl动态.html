<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/move.js"></script>
    <script src="js/listData.js"></script>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/ysl动态.css">

</head>
<body>
  <div id="head"></div>
  <div class="ctnbox">
      <h1 class="title">最新动态</h1>
      <h2>Latest News</h2>
      <img src="images/three_points01.png" alt="" >
      <h1 class="title-list">
          动态
      </h1>

      <div class="list-ctn" id="articleList">

      </div>

      <!--模板-->
      <div id="itemHtml" style="display:none;">
          <div class="ctnone" articleid="$articleId$">
              <div class="ctnoneimg"><img src="$articleCover$"></div>
              <div class="ctn-text">
                  <div class="title_small">$articleTitle$</div>
                  <p>$describe$</p>
                  <div class="date">$updateTime$</div>
              </div>
              <img class="list_img_over_xiaojiantou" src="images/list_img_over_xiaojiantou.png">
          </div>
      </div>
      <div class="list-more"></div>
  </div>
  <div id="foot"></div>
</body>

<script>
    var GLOBAL = GLOBAL || {};
    $(function () {
        $('#head').load('header.html');
        $('#foot').load('footer.html');


        $('.list-more').hover(function () {
            $(this).animate({backgroundPositionY:0},100)
        },function(){
            $(this).animate({backgroundPositionY:-58},800)
        })



        $("#articleList").delegate(".ctnone", "click", function(){
            window.open("article.html?"+"type=" + getUrlParams("type")+ "&articleId=" + $(this).attr("articleId"), "_blank");
        });

        loadArticleList();

        $(".list-more").click(function(){
            if(GLOBAL.pageStart < GLOBAL.pageCount){
                loadArticleList();
            }

        })
    })



    function loadArticleList(){
        //先ajax请求数据，然后就行下面的操作，此处数据先写好在了listData.js里，可以直接使用，格式和服务器返回的json一致。
        if(!GLOBAL.pageStart){
            $("#articleList").html("");
            GLOBAL.pageStart = 0;
        }
        var itemHtml = '';
        var result = listData["listData0" +GLOBAL.pageStart]; //此数据在listData.js里
        var list = result.data.list;
        if(!list || !list.length){
            $("#articleList").html("暂时没有内容，敬请期待！");
        } else {
            var updateTime;
            for(var i=0; i < list.length; i++){
                updateTime = list[i].updateAt || list[i].creatAt;
                itemHtml = $("#itemHtml").html().replace("$articleCover$", list[i].coverImg)
                        .replace("$articleId$", list[i].sysId)
                        .replace("$articleTitle$", list[i].title)
                        .replace("$updateTime$", updateTime ? updateTime.substr(0, 10) : "")
                        .replace("$describe$", list[i].describe);
                $("#articleList").append(itemHtml);
            }
        }

        //用于加载下一页时使用
        GLOBAL.pageStart = result.data.pageStart + 1;
        GLOBAL.pageCount = Math.ceil(result.data.count/result.data.pageSize);
        if(GLOBAL.pageStart >= GLOBAL.pageCount){
            $(".list-more").css("opacity","0.3")
        }
    }


    //获取页面url传过来的参数
    function getUrlParams(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)
            return  r[2];
        else
            return "";
    }

</script>
</html>



